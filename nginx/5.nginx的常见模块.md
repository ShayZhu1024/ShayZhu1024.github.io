# nginx 常见模块

## 访问控制基于模块ngx_http_access_module实现，可以通过匹配客户端源IP地址进行限制
```bash
location = /login/ {
   root /data/nginx/html/pc;
   allow 10.0.0.0/24;
   deny all;
}

location /about {
   alias /data/nginx/html/pc;
   index index.html;
   deny  192.168.1.1;
   allow 192.168.1.0/24;
   allow 10.1.1.0/16;
   allow 2001:0db8::/32;
   deny all;              #按先小范围在前，大范围在后排序
}

```

## 自定义错误页面 error_page

自定义错误页，同时也可以用指定的响应状态码进行响应, 可用位置：http, server, location, if in  location
```bash
Syntax: error_page code ... [=[response]] uri;
Default: —
Context: http, server, location, if in location


listen 80;
server_name www.wang.org;
error_page  500 502 503 504 /error.html;
location = /error.html {
   root /data/nginx/html;
}


#404转为302
#error_page 404 /index.html;
error_page  404  =302 /index.html; 
error_page 500 502 503 504 /50x.html;
     location = /50x.html {
}

```

## 自定义错误日志
```bash
Syntax: error_log file [level];
Default: 
error_log logs/error.log error;
Context: main, http, mail, stream, server, location
level: debug, info, notice, warn, error, crit, alert, emerg
#关闭错误日志
error_log /dev/null;
```

## 检测文件是否存在

try_files 会按顺序检查文件是否存在，返回第一个找到的文件或文件夹（结尾加斜线表示为文件夹），
如果所有文件或文件夹都找不到，会进行一个内部重定向到最后一个参数。只有最后一个参数可以引起
一个内部重定向，之前的参数只设置内部URI的指向。最后一个参数是回退URI且必须存在，否则会出现
内部500错误。

```bash
http://nginx.org/en/docs/http/ngx_http_core_module.html#try_files
Syntax: try_files file ... uri;
try_files file ... =code;
Default: —
Context: server, location

 location / {
        # First attempt to serve request as file, then
        # as directory, then fall back to displaying a 404.
       try_files $uri $uri/ =404;
}

location / {
   root /data/nginx/html/pc;
   index index.html;
   try_files $uri  $uri.html $uri/index.html /default.html;
    #try_files $uri $uri/index.html $uri.html =489;
}


```

## 长连接配置

```bash
keepalive_time time;      #限制对一个连接中请求处理的最长时间,到时间后续的再有新的请求会断开连接,默认1h
keepalive_timeout timeout [header_timeout];  #设置保持空闲的连接超时时长，0表示禁止长连接，默认为75s，通常配置在http字段作为站点全局配置
keepalive_requests number;  #在一次长连接上所允许请求的资源的最大数量，默认为1000次
```



