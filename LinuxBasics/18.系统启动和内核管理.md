# 系统启动和内核管理

## 1.centos6启动

### 1.硬件启动流程

#### 1.1打开电源

- CPU加电，硬件重置CPU启动寻址0xFFFF0,而这个地址指向BIOS程序

#### 1.2执行BIOS

- POST

	- 初始化硬件设备，检查系统外围主要设备：CPU，内存，硬盘，显卡，IO设备

- 确定启动设备

	- 根据BIOS设置的启动顺序(硬盘，U盘，光盘)，读取启动设备的第一个扇区446Byte到内存，然后BIOS将控制权交由grub stage1

### 2.grub启动引导

#### 2.1 stage 1

- grub stage 1 是一个非常短小的程序446字节，这个程序目的是加载stage1.5阶段引导代码（512byte之后到第一个分区之前的gap）到内存中去

#### 2.2 stage1.5

- stage1.5加到内存之后执行1.5引导程序，grub1.5就可以读取基础的文件系统，此时可以访问处于文件系统里面的/boot/grub/stage2，将其加载到内存

#### 2.3 stage2

- 执行stage2 代码

	- 解析grub配置文件/boot/grub.conf
	- 显示操作系统启动菜单
	- 加载内核镜像到内存
	- 加载/boot/initramfs....文件到内存中，在内存中建立一个临时的根文件系统,这个文件包含了必要的工具和设备驱动程序，能够让内核识别更加复杂的文件系统和设备

### 3 内核引导阶段

1. 调用和执行临时根文件系统中的init脚本执行初始化
2. 加载驱动模块初始化系统中的各设备并作相关配置
3. 加载并切换真正的根文件系统（grub.conf中root=所指定）
4. 切换到真正的根文件系统 ，执行init程序，Linux系统第一个进程

### 4.系统初始化阶段

#### 4.1 /etc/inittab

- 获取用户运行级别

#### 4.2 /etc/rc.sysinit 脚本

- 进行一些列系统的初始化操作，包括 获取网络环境与主机名，挂载所有在/etc/fstable 定义的文件系统，等等

#### 4.3加载系统服务

-  /etc/rc.d/rc#.d

	- 根据运行级别启动对应的/etc/rc.d/rc#.d目录下的服务（#0-6）

		- S开头的start
		- K开头stop

- /etc/rc.local

	- 加载用户自定义服务
