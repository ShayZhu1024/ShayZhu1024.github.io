# 磁盘存储和文件系统

## 磁盘结构

### 设备文件

```bash
设备号码：
    主设备号：major number, 标识设备类型
    次设备号：minor number, 标识同一类型下的不同设备

设备类型：
    块设备：block，存取单位“块”，磁盘
    字符设备：char，存取单位“字符”，键盘

常见磁盘文件的设备名称

    /dev/sdX   # SAS,SATA,SCSI,IDE,USB 
    /dev/nvme0n#   #nvme协议硬盘，如：第一个硬盘：nvme0n1，第二个硬盘：nvme0n2

    虚拟磁盘：
    /dev/vd 
    /dev/xvd
```

## 机械硬盘
```bash
三个术语: CHS

head：磁头 磁头数=盘面数
track：磁道 磁道=柱面数
sector：扇区，512bytes
cylinder 柱面=512 * sector数/track*head数
dd | hdparm -t /dev/sda  #磁盘测速



```

## 存储管理

### 使用磁盘三个步骤
1. 创建分区
2. 格式化文件系统(也可以不分区，直接整块硬盘格式化文件系统)
3. 挂载

### 为什么分区
* 优化I/O性能
* 实现磁盘空间配额限制
* 提高修复速度
* 隔离系统和程序
* 安装多个OS
* 采用不同文件系统

###  MBR分区
MBR：Master Boot Record，1982年，使用32位表示扇区数，硬盘大小不超过2T 2^32*512/1024/1024/1024=2T

```bash
0磁道0扇区：512bytes
 446bytes: boot loader 启动相关
 64bytes：分区表，其中每16bytes标识一个分区
 2bytes: 55AA，标识位
 主分区+扩展分区=4
 逻辑分区起始号码 5

```

### gpt分区

```bash
GPT：GUID（Globals Unique Identifiers） partition table 支持128个分区，使用64位，支持8Z（
512Byte/block ）64Z （ 4096Byte/block）
使用128位UUID(Universally Unique Identifier) 表示磁盘和分区 GPT分区表自动备份在头和尾两份，
并有CRC校验位
UEFI (Unified Extensible Firmware Interface 统一可扩展固件接口)硬件支持GPT，使得操作系统可以
启动
```

### 通常组合 MBR+BIOS  GPT+UEFI

## 管理分区


## 常用命令
```bash
df  查看磁盘文件系统
fdisk -l /dev/sda #查看磁盘设备文件系统
lsblk -d -o  name,rota   #1表示机械，0表示SSD
lsblk -f 查看所有块设备上的文件系统
lsblk -f /dev/sda
df 只能查看挂载的设备的文件系统
dd 块拷贝
    of 输出
    if 输入
    count 块数量
    bs 块大小  默认是字节
    skip N  跳过if的N个块
    seek N 跳过of的N个块
```