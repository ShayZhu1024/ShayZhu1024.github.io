# 加密和安全

## 常见的安全攻击STRIDE
* Spoofing 假冒，钓鱼网站
* Tampering 篡改
* Repudiation 否认
* Information Disclosure 信息泄漏
* Denial of Service 拒绝服务
* Elevation of Privilege 提升权限

## 安全设计基本原则
* 使用成熟的安全系统
* 以小人之心度输入数据
* 外部系统是不安全的
* 最小授权
* 减少外部接口
* 缺省使用安全模式
* 安全不是似是而非
* 从STRIDE思考
* 在入口处检查
* 从管理上保护好你的系统

## 常用的安全技术
* 认证
* 授权
* 审计
* 安全通信


## 加密算法和协议

### 对称加密
加密和解密使用同一个密钥
```bash
特征
    加密、解密使用同一个密钥，效率高
    将原始数据分割成固定大小的块，逐个进行加密

缺陷：
    密钥过多            每一个需要加密的文件都需要重新创建一个密钥
    密钥分发            如何把密钥安全传递给其他人
    数据来源无法确认    如何确保这个加密文件的来源

常见的对称加密算法
    DES：Data Encryption Standard，56bits
    3DES：
    AES：Advanced (128, 192, 256bits)
    Blowfish，Twofish
    IDEA，RC6，CAST5
```

### 非对称加密

```bash
非对称加密：密钥是成对出现
    公钥：public key，公开给所有人，主要给别人加密使用
    私钥：secret key，private key 自己留存，必须保证其私密性，用于自已加密签名
    特点：用公钥加密数据，只能使用与之配对的私钥解密；反之亦然

功能：

    数据加密：适合加密较小数据,比如: 加密对称密钥
    数字签名：主要在于让接收方确认发送方身份

缺点：
    密钥长,算法复杂
    加密解密效率低下

常见算法：
    RSA：由 RSA 公司发明，是一个支持变长密钥的公共密钥算法，需要加密的文件块的长度也是可变的,可实现加密和数字签名
    DSA（Digital Signature Algorithm）：数字签名算法，是一种标准的 DSS（数字签名标准）
    ECC（Elliptic Curves Cryptography）：椭圆曲线密码编码学，比RSA加密算法使用更小的密钥，提供相当的或更高等级的安全

```

### 单向hash哈希

```bash
哈希算法：也称为散列算法，将任意数据缩小成固定大小的“指纹”，称为digest，即摘要

特性：
    任意长度输入，固定长度输出
    若修改数据，指纹也会改变，且有雪崩效应，数据的一点微小改变，生成的指纹值变化非大
    无法从指纹中重新生成数据，即不要逆，具有单向性

功能：用于验证数据完整性

常见算法
    md5: 128bits、sha1: 160bits、sha224 、sha256、sha384、sha512


常用工具
    md5sum | sha1sum [ --check ] file
    openssl、gpg
    rpm -V

```


## CA和证书
<img src="../images/ca001.png">

```bash
PKI：Public Key Infrastructure 公共密钥加密体系
签证机构：CA（Certificate Authority）
注册机构：RA
证书吊销列表：CRL
证书存取库：
X.509：定义了证书的结构以及认证协议标准
    版本号
    序列号
    签名算法
    颁发者
    有效期限
    主体名称

证书类型：
    证书授权机构的证书
    服务器证书
    用户证书

获取证书两种方法：
    自签名的证书： 自已签发自己的公钥
    使用证书授权机构：
            生成证书请求（csr）
            将证书请求csr发送给CA
            CA签名颁发证书
```

## 安全协议SSL/TLS

```bash
SSL：Secure Socket Layer，TLS: Transport Layer Security
SSL 最初是由网景公司设计和开发的，后来IETF组织将其进行标准化，命名为TLS

功能
    机密性
    认证
    完整性
    重放保护
```

## https工作的简化过程

<img src="../images/https01.png">

```bash
1. 客户端发起HTTPS请求,用户在浏览器里输入一个https网址，然后连接到服务器的443端口
2. 服务端的配置采用HTTPS协议的服务器必须要有一套数字证书，可以自己制作，也可以向组织申请。区别就是自己颁发的证书需要客户端验证通过，才可以继续访问，而使用受信任的公司申请的证书则不会弹出提示页面。这套证书其实就是一对公钥和私钥
3. 传送服务器的证书给客户端证书里其实就是公钥，并且还包含了很多信息，如证书的颁发机构，过期时间等等
4. 客户端解析验证服务器证书这部分工作是由客户端的TLS来完成的，首先会验证公钥是否有效，比如：颁发机构，过期时间等等，如果发现异常，则会弹出一个警告框，提示证书存在问题。如果证书没有问题，那么就生成一个随机值。然后用证书中公钥对该随机值进行非对称加密
5. 客户端将加密信息传送服务器这部分传送的是用证书加密后的随机值，目的就是让服务端得到这个随机值，以后客户端和服务端的通信就可以通过这个随机值来进行加密解密了
6. 服务端解密信息服务端将客户端发送过来的加密信息用服务器私钥解密后，得到了客户端传过来的随机值
7. 服务器加密信息并发送信息服务器将数据利用随机值进行对称加密,再发送给客户端
8. 客户端接收并解密信息客户端用之前生成的随机值解密服务段传过来的数据，于是获取了解密后的内容
```

## openssl
